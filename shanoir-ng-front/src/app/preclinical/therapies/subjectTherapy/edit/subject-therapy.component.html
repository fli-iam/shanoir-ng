<!--
Shanoir NG - Import, manage and share neuroimaging data
Copyright (C) 2009-2019 Inria - https://www.inria.fr/
Contact us on https://project.inria.fr/shanoir/

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

You should have received a copy of the GNU General Public License
along with this program. If not, see https://www.gnu.org/licenses/gpl-3.0.html
-->

<div #formContainer class="content-component">
    @if (form) {
        <form [formGroup]="form" class="max-content" novalidate [class.disabled]="footerState.loading">
            <div class="layout">
                <form-footer [state]="footerState" (save)="save()" (back)="goBack()"></form-footer>
                <span>
                    @switch (mode) {
                        @case ("view") {
                            <h2 class="header command-zone">Details on subject pathology</h2>
                        }
                        @case ("edit") {
                            <h2 class="header command-zone">Edit subject pathology</h2>
                        }
                        @case ("create") {
                            <h2 class="header command-zone">Create a pathology record for a subject</h2>
                        }
                    }
                </span>
                <fieldset>
                    <ol>
                        <li>
                            <label>Therapy</label>
                            <span class="right-col">
                                @switch (mode) {
                                    @case ("view") {
                                        {{ subjectTherapy?.therapy?.name }}
                                    }
                                    @default {
                                        <select-box
                                            formControlName="therapy"
                                            [optionArr]="therapies"
                                            (newOption)="isUserAdmin() ? goToAddTherapy() : null"></select-box>
                                        @if (hasError("therapy", ["required"])) {
                                            <label
                                                animate.enter="slide-down-error" animate.leave="slide-up-error"
                                                class="form-validation-alert">
                                                Therapy is required!
                                            </label>
                                        }
                                    }
                                }
                            </span>
                        </li>
                        <li>
                            <label>Dose</label>
                            <span class="right-col">
                                @switch (mode) {
                                    @case ("view") {
                                        {{ subjectTherapy?.dose }}
                                    }
                                    @default {
                                        <input type="number" min="0" formControlName="dose" />
                                    }
                                }
                            </span>
                        </li>
                        <li>
                            <label>Units</label>
                            <span class="right-col">
                                @switch (mode) {
                                    @case ("view") {
                                        {{ subjectTherapy?.doseUnit.value }}
                                    }
                                    @default {
                                        <select-box formControlName="doseUnit" [optionArr]="units"></select-box>
                                    }
                                }
                            </span>
                        </li>
                        <li>
                            <label>Frequency</label>
                            <span class="right-col">
                                @switch (mode) {
                                    @case ("view") {
                                        {{ subjectTherapy?.frequency }}
                                    }
                                    @default {
                                        <select-box formControlName="frequency" [optionArr]="frequencies"></select-box>
                                    }
                                }
                            </span>
                        </li>
                        <li>
                            <label>Molecule</label>
                            <span class="right-col">
                                @switch (mode) {
                                    @case ("view") {
                                        {{ subjectTherapy?.molecule }}
                                    }
                                    @default {
                                        <input formControlName="molecule" />
                                    }
                                }
                            </span>
                        </li>
                        <li>
                            <label>Start Date</label>
                            <span class="right-col">
                                @switch (mode) {
                                    @case ("view") {
                                        {{ subjectTherapy?.startDate | date: "shortDate" }}
                                    }
                                    @default {
                                        <datepicker formControlName="startDate"></datepicker>
                                        @if (hasError("startDate", ["date-format"])) {
                                            <label
                                                animate.enter="slide-down-error" animate.leave="slide-up-error"
                                                class="form-validation-alert">
                                                Start date is required!
                                            </label>
                                        }
                                    }
                                }
                            </span>
                        </li>
                        <li>
                            <label>End Date</label>
                            <span class="right-col">
                                @switch (mode) {
                                    @case ("view") {
                                        {{ subjectTherapy?.endDate | date: "shortDate" }}
                                    }
                                    @default {
                                        <datepicker formControlName="endDate"></datepicker>
                                        @if (hasError("endDate", ["date-format"])) {
                                            <label
                                                animate.enter="slide-down-error" animate.leave="slide-up-error"
                                                class="form-validation-alert">
                                                End date is required!
                                            </label>
                                        }
                                    }
                                }
                            </span>
                        </li>
                    </ol>
                </fieldset>
            </div>
        </form>
    }
</div>
