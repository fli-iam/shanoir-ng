<!--
Shanoir NG - Import, manage and share neuroimaging data
Copyright (C) 2009-2019 Inria - https://www.inria.fr/
Contact us on https://project.inria.fr/shanoir/

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

You should have received a copy of the GNU General Public License
along with this program. If not, see https://www.gnu.org/licenses/gpl-3.0.html
-->

<span class="arrow" (click)="toggle()">
    @if (hasChildren == true && isOpen) {
        <span><i class="fas fa-angle-down"></i></span>
    }
    @if (hasChildren == true && !isOpen) {
        <span><i class="fas fa-angle-right"></i></span>
    }
    @if (hasChildren == "unknown" && !isOpen && !dataLoading) {
        <span><i class="fas fa-angle-right"></i></span>
    }
</span>
<div class="node" [class.clickable-node]="isClickable()" title="{{ title }}">
    @if (dataLoading) {
        <span>
            <div class="fa fa-cog fa-spin"></div>
        </span>
    }
    @if (!dataLoading && pictoUrl) {
        <a
            [routerLink]="route"
            (click)="labelClick.emit()"
            (dblclick)="toggle()"
            class="picto"
            [class.clickable]="isClickable()">
            <img class="picto" src="{{ pictoUrl }}" alt="node pictogram" />
        </a>
    }
    @if (!dataLoading && awesome) {
        <a
            [routerLink]="route"
            (click)="labelClick.emit()"
            (dblclick)="toggle()"
            class="picto"
            [class.clickable]="isClickable()">
            <i class="{{ awesome }}"></i>
        </a>
    }
    @if (!downloadable) {
        <a (click)="labelClick.emit()" (dblclick)="toggle()" class="picto" [class.clickable]="isClickable()">
            <i class="fa-solid fa-lock"></i>
        </a>
    }
    @if (hasBox) {
        <input
            #box
            class="box"
            type="checkbox"
            [(ngModel)]="value"
            (change)="chkbxChange.emit(value)"
            class="clickable" />
    }
    @if (editable) {
        <input #editableLabel type="text" [(ngModel)]="label" (change)="labelChange.emit(label)" />
    }
    @if (editable && buttonPicto) {
        <span class="button-picto clickable" (click)="buttonClick.emit()">
            <i class="{{ buttonPicto }}"></i>
        </span>
    }
    @if (!editable) {
        <span class="label">
            <a (click)="labelClick.emit()" [routerLink]="route" (dblclick)="toggle()" [class.clickable]="isClickable()">
                {{ label }}
            </a>
            @if (buttonPicto) {
                <span class="button-picto clickable" (click)="buttonClick.emit()">
                    <i class="{{ buttonPicto }}"></i>
                </span>
            }
            <span class="button-picto clickable overmenu">
                <ng-content select=".overmenu"></ng-content>
            </span>
        </span>
    }
    <span>
        <ng-content select="dropdown-menu"></ng-content>
    </span>
    @if (qualityTag) {
        <span
            class="tag label dark"
            [style.background]="qualityTag == 'ERROR' ? 'red' : qualityTag == 'WARNING' ? 'orange' : 'green'">
            {{ qualityTag }}
        </span>
    }
    @for (tag of tags; track tag) {
        <span class="tag label" [class.dark]="getFontColor(tag.color)" [style.background]="tag.color">
            {{ tag.name }}
        </span>
    }
    @if (tooltip) {
        <tool-tip>{{ tooltip }}</tool-tip>
    }
</div>
@if (isOpen) {
    <div #childrentWrapper class="content">
        <ng-content></ng-content>
    </div>
}
